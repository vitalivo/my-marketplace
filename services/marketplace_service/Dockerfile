# -------------------------------------------------
# 1️⃣  Базовый образ
# -------------------------------------------------
FROM python:3.11-slim

# -------------------------------------------------
# 2️⃣  Системные библиотеки, нужные для PostGIS (GEOS, GDAL, PROJ)
# -------------------------------------------------
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        gcc \
        libpq-dev \
        binutils \
        libproj-dev \
        gdal-bin && \
    rm -rf /var/lib/apt/lists/*

# -------------------------------------------------
# 3️⃣  Рабочая директория внутри контейнера
# -------------------------------------------------
WORKDIR /app

# -------------------------------------------------
# 4️⃣  Копируем только файл зависимостей и ставим их
# -------------------------------------------------
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# -------------------------------------------------
# 5️⃣  Копируем весь проект (при dev‑монтировании будет переопределено)
# -------------------------------------------------
COPY . .

# -------------------------------------------------
# 6️⃣  Команда, которая будет исполняться по‑умолчанию
# -------------------------------------------------
#   - Для продакшн‑окружения будем использовать gunicorn (см. ниже)
#   - Для разработки docker‑compose переопределит её на `runserver`
CMD ["gunicorn", "marketplace.wsgi:application", "--bind", "0.0.0.0:8000"]